<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Exclus√£o de Faturas Frontend</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .error {
            background-color: #fee;
            border: 1px solid #fcc;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            background-color: #efe;
            border: 1px solid #cfc;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .info {
            background-color: #eef;
            border: 1px solid #ccf;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        button {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #c82333;
        }
        .log {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Debug - Exclus√£o de Faturas Frontend</h1>
        <p>Esta p√°gina ajuda a diagnosticar problemas com a exclus√£o de faturas no frontend.</p>
    </div>

    <div class="container">
        <h2>1. Verifica√ß√£o de Console</h2>
        <div id="console-check" class="info">
            <p>Abra o DevTools (F12) e v√° para a aba Console. Clique no bot√£o abaixo para simular erros:</p>
            <button onclick="testConsoleErrors()">Testar Erros no Console</button>
        </div>
        <div id="console-log" class="log"></div>
    </div>

    <div class="container">
        <h2>2. Teste de Fun√ß√£o de Exclus√£o</h2>
        <div id="delete-test">
            <p>Teste simulado da fun√ß√£o handleDeleteInvoice:</p>
            <button onclick="simulateDeleteInvoice()">Simular Exclus√£o</button>
            <button onclick="testConfirmDialog()">Testar Confirma√ß√£o</button>
        </div>
        <div id="delete-log" class="log"></div>
    </div>

    <div class="container">
        <h2>3. Verifica√ß√£o de Event Listeners</h2>
        <div id="event-test">
            <p>Teste de event listeners em bot√µes de exclus√£o:</p>
            <button id="test-delete-btn" onclick="testEventListener()">üóëÔ∏è Bot√£o de Teste</button>
        </div>
        <div id="event-log" class="log"></div>
    </div>

    <div class="container">
        <h2>4. Teste de Supabase Connection</h2>
        <div id="supabase-test">
            <p>Verificar conex√£o com Supabase:</p>
            <button onclick="testSupabaseConnection()">Testar Conex√£o</button>
        </div>
        <div id="supabase-log" class="log"></div>
    </div>

    <div class="container">
        <h2>5. Instru√ß√µes para Debug</h2>
        <div class="info">
            <h3>Como usar este debug:</h3>
            <ol>
                <li><strong>Abra o DevTools (F12)</strong> e v√° para a aba Console</li>
                <li><strong>V√° para a p√°gina de Faturas</strong> na aplica√ß√£o principal</li>
                <li><strong>Clique em um bot√£o de exclus√£o</strong> (lixeira vermelha)</li>
                <li><strong>Observe os erros no Console</strong> do DevTools</li>
                <li><strong>Volte aqui</strong> e execute os testes para comparar</li>
            </ol>
            
            <h3>Erros comuns a procurar:</h3>
            <ul>
                <li><code>TypeError: Cannot read property 'id' of undefined</code></li>
                <li><code>Error: Row Level Security policy violation</code></li>
                <li><code>Error: delete on table "invoices" violates foreign key constraint</code></li>
                <li><code>Network Error</code> ou <code>Failed to fetch</code></li>
                <li><code>Uncaught (in promise)</code> errors</li>
            </ul>
        </div>
    </div>

    <script>
        let logCounter = 0;

        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}\n`;
            element.textContent += logEntry;
            element.scrollTop = element.scrollHeight;
            
            // Tamb√©m logar no console do navegador
            console.log(`[DEBUG] ${logEntry.trim()}`);
        }

        function testConsoleErrors() {
            log('console-log', 'Iniciando teste de erros no console...', 'info');
            
            // Simular diferentes tipos de erro
            try {
                // Erro de propriedade undefined
                const obj = undefined;
                obj.id; // Isso vai gerar um erro
            } catch (error) {
                log('console-log', `Erro simulado 1: ${error.message}`, 'error');
            }
            
            try {
                // Erro de fun√ß√£o n√£o definida
                nonExistentFunction();
            } catch (error) {
                log('console-log', `Erro simulado 2: ${error.message}`, 'error');
            }
            
            // Simular erro de rede
            fetch('http://invalid-url-test')
                .catch(error => {
                    log('console-log', `Erro de rede simulado: ${error.message}`, 'error');
                });
                
            log('console-log', 'Teste de erros conclu√≠do. Verifique o Console do DevTools.', 'success');
        }

        function simulateDeleteInvoice() {
            log('delete-log', 'Simulando fun√ß√£o handleDeleteInvoice...', 'info');
            
            // Simular a l√≥gica da fun√ß√£o handleDeleteInvoice
            const mockInvoice = {
                id: 'test-invoice-id',
                invoice_number: 'INV-001',
                client_id: 'test-client-id'
            };
            
            log('delete-log', `Fatura mock: ${JSON.stringify(mockInvoice)}`, 'info');
            
            // Simular confirma√ß√£o
            const confirmed = confirm('Tem certeza que deseja excluir esta fatura?');
            log('delete-log', `Confirma√ß√£o do usu√°rio: ${confirmed}`, 'info');
            
            if (confirmed) {
                // Simular chamada para deleteInvoice
                log('delete-log', 'Chamando deleteInvoice(mockInvoice.id)...', 'info');
                
                // Simular delay de rede
                setTimeout(() => {
                    log('delete-log', 'Simula√ß√£o de exclus√£o conclu√≠da com sucesso', 'success');
                }, 1000);
            } else {
                log('delete-log', 'Exclus√£o cancelada pelo usu√°rio', 'info');
            }
        }

        function testConfirmDialog() {
            log('delete-log', 'Testando dialog de confirma√ß√£o...', 'info');
            
            const result = confirm('Esta √© uma confirma√ß√£o de teste. Clique OK ou Cancelar.');
            log('delete-log', `Resultado da confirma√ß√£o: ${result}`, result ? 'success' : 'info');
        }

        function testEventListener() {
            log('event-log', 'Evento de clique capturado com sucesso!', 'success');
            log('event-log', 'Event listener est√° funcionando corretamente.', 'info');
            
            // Testar se o evento tem as propriedades esperadas
            const event = window.event;
            if (event) {
                log('event-log', `Tipo do evento: ${event.type}`, 'info');
                log('event-log', `Target: ${event.target.tagName}`, 'info');
                log('event-log', `ID do target: ${event.target.id}`, 'info');
            }
        }

        function testSupabaseConnection() {
            log('supabase-log', 'Testando conex√£o com Supabase...', 'info');
            
            // Tentar acessar localhost:8081 (onde a aplica√ß√£o est√° rodando)
            fetch('http://localhost:8081')
                .then(response => {
                    log('supabase-log', `Aplica√ß√£o principal acess√≠vel: ${response.status}`, 'success');
                    return response.text();
                })
                .then(html => {
                    if (html.includes('supabase')) {
                        log('supabase-log', 'Refer√™ncias ao Supabase encontradas na aplica√ß√£o', 'success');
                    } else {
                        log('supabase-log', 'Nenhuma refer√™ncia ao Supabase encontrada', 'error');
                    }
                })
                .catch(error => {
                    log('supabase-log', `Erro ao acessar aplica√ß√£o: ${error.message}`, 'error');
                });
        }

        // Capturar erros globais
        window.addEventListener('error', function(event) {
            log('console-log', `Erro global capturado: ${event.error.message}`, 'error');
            log('console-log', `Arquivo: ${event.filename}:${event.lineno}`, 'error');
        });

        // Capturar promises rejeitadas
        window.addEventListener('unhandledrejection', function(event) {
            log('console-log', `Promise rejeitada: ${event.reason}`, 'error');
        });

        // Log inicial
        log('console-log', 'Debug frontend iniciado. Aguardando testes...', 'info');
    </script>
</body>
</html>