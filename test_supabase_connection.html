<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Conex√£o Supabase</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Teste de Conex√£o Supabase</h1>
    <div id="output"></div>
    <button onclick="testConnection()">Testar Conex√£o</button>
    
    <script>
        const supabaseUrl = 'https://jjqhgvnzjwkhsrebcjvn.supabase.co'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpqcWhndm56andraHNyZWJjanZuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE0MTEyOTMsImV4cCI6MjA2Njk4NzI5M30.3lQZZ1l0umn1PWtS7EcoFvkZBgB9pZcqYZg92LhhXhw'
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey)
        
        function log(message) {
            const output = document.getElementById('output')
            output.innerHTML += '<p>' + new Date().toLocaleTimeString() + ': ' + message + '</p>'
            console.log(message)
        }
        
        async function testConnection() {
            try {
                log('üîç Testando conex√£o com Supabase...')
                
                // 1. Testar autentica√ß√£o
                log('1Ô∏è‚É£ Verificando autentica√ß√£o...')
                const { data: { user }, error: authError } = await supabase.auth.getUser()
                if (authError) {
                    log('‚ùå Erro de autentica√ß√£o: ' + authError.message)
                } else if (user) {
                    log('‚úÖ Usu√°rio autenticado: ' + user.email)
                } else {
                    log('‚ö†Ô∏è Usu√°rio n√£o autenticado')
                }
                
                // 2. Testar query simples na tabela organizations
                log('2Ô∏è‚É£ Testando query na tabela organizations...')
                const { data: orgs, error: orgError } = await supabase
                    .from('organizations')
                    .select('id, name')
                    .limit(5)
                
                if (orgError) {
                    log('‚ùå Erro ao buscar organiza√ß√µes: ' + orgError.message)
                } else {
                    log('‚úÖ Organiza√ß√µes encontradas: ' + (orgs?.length || 0))
                    if (orgs && orgs.length > 0) {
                        log('üìã Primeira organiza√ß√£o: ' + JSON.stringify(orgs[0]))
                    }
                }
                
                // 3. Testar query na tabela expenses
                log('3Ô∏è‚É£ Testando query na tabela expenses...')
                const { data: expenses, error: expError } = await supabase
                    .from('expenses')
                    .select('id, title, amount')
                    .limit(5)
                
                if (expError) {
                    log('‚ùå Erro ao buscar despesas: ' + expError.message)
                    log('‚ùå C√≥digo do erro: ' + expError.code)
                    log('‚ùå Detalhes: ' + JSON.stringify(expError.details))
                } else {
                    log('‚úÖ Despesas encontradas: ' + (expenses?.length || 0))
                    if (expenses && expenses.length > 0) {
                        log('üìã Primeira despesa: ' + JSON.stringify(expenses[0]))
                    }
                }
                
                // 4. Testar query na tabela user_organizations (se usu√°rio autenticado)
                if (user) {
                    log('4Ô∏è‚É£ Testando query na tabela user_organizations...')
                    const { data: userOrgs, error: userOrgError } = await supabase
                        .from('user_organizations')
                        .select('organization_id, role')
                        .eq('user_id', user.id)
                    
                    if (userOrgError) {
                        log('‚ùå Erro ao buscar user_organizations: ' + userOrgError.message)
                    } else {
                        log('‚úÖ Associa√ß√µes usu√°rio-organiza√ß√£o: ' + (userOrgs?.length || 0))
                        if (userOrgs && userOrgs.length > 0) {
                            log('üìã Primeira associa√ß√£o: ' + JSON.stringify(userOrgs[0]))
                        }
                    }
                }
                
                log('üèÅ Teste de conex√£o conclu√≠do!')
                
            } catch (error) {
                log('‚ùå Erro JavaScript: ' + error.message)
                console.error('Erro completo:', error)
            }
        }
        
        // Auto-executar
        window.addEventListener('load', () => {
            setTimeout(testConnection, 1000)
        })
    </script>
</body>
</html>